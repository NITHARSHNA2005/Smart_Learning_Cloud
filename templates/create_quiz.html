{% extends "base.html" %}

{% block title %}Create Quiz - {{ lesson['title'] }} - Smart Learning Cloud{% endblock %}

{% block content %}
<div style="margin-bottom: 2rem;">
  <a href="{{ url_for('teacher') }}" style="color: var(--primary); text-decoration: none; font-weight: 500;">
    ‚Üê Back to Teacher Dashboard
  </a>
</div>

<div class="card" style="margin-bottom: 2rem;">
  <h1 style="margin: 0 0 1rem 0; color: var(--primary);">üìù Create Quiz</h1>
  <p style="color: var(--text-light); margin: 0;">
    Creating quiz for: <strong>{{ lesson['title'] }}</strong>
  </p>
</div>

<form method="post" id="quiz-form">
  <div class="card" style="margin-bottom: 2rem;">
    <h3 style="margin-top: 0;">Quiz Details</h3>
    <div class="form-group">
      <label for="quiz_title">Quiz Title</label>
      <input type="text" id="quiz_title" name="quiz_title" class="form-control" 
             value="{{ lesson['title'] }} Quiz" required>
    </div>
  </div>

  <div id="questions-container">
    <!-- Questions will be added here dynamically -->
  </div>

  <div class="card" style="text-align: center; margin-bottom: 2rem;">
    <button type="button" onclick="addQuestion()" class="btn btn-secondary">
      ‚ûï Add Question
    </button>
    <button type="submit" class="btn" style="margin-left: 1rem;">
      ‚ú® Create Quiz
    </button>
  </div>
</form>

<div class="card" style="background: var(--bg);">
  <h3 style="margin-top: 0;">üí° Quiz Creation Tips</h3>
  <ul style="margin: 0; padding-left: 1.5rem;">
    <li>Create 4-8 questions for optimal engagement</li>
    <li>Provide 3-4 answer options for each question</li>
    <li>Make questions clear and specific</li>
    <li>Include a mix of easy, medium, and challenging questions</li>
    <li>Use topics to categorize questions for better analytics</li>
  </ul>
</div>
{% endblock %}

{% block scripts %}
<script>
let questionCount = 0;

function addQuestion() {
  questionCount++;
  const container = document.getElementById('questions-container');
  
  const questionDiv = document.createElement('div');
  questionDiv.className = 'card';
  questionDiv.style.marginBottom = '2rem';
  questionDiv.id = `question-${questionCount}`;
  
  questionDiv.innerHTML = `
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
      <h3 style="margin: 0;">Question ${questionCount}</h3>
      <button type="button" onclick="removeQuestion(${questionCount})" class="btn btn-danger" style="padding: 0.5rem;">
        üóëÔ∏è Remove
      </button>
    </div>
    
    <div class="form-group">
      <label for="question-${questionCount}-text">Question Text</label>
      <textarea id="question-${questionCount}-text" name="questions" class="form-control" rows="2" 
                placeholder="Enter your question here..." required></textarea>
    </div>
    
    <div class="form-group">
      <label for="question-${questionCount}-options">Answer Options (one per line)</label>
      <textarea id="question-${questionCount}-options" name="options" class="form-control" rows="4" 
                placeholder="Option 1&#10;Option 2&#10;Option 3&#10;Option 4" required></textarea>
    </div>
    
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
      <div class="form-group">
        <label for="question-${questionCount}-answer">Correct Answer (1-4)</label>
        <select id="question-${questionCount}-answer" name="correct_answers" class="form-control" required>
          <option value="0">Option 1</option>
          <option value="1">Option 2</option>
          <option value="2">Option 3</option>
          <option value="3">Option 4</option>
        </select>
      </div>
      
      <div class="form-group">
        <label for="question-${questionCount}-topic">Topic/Category</label>
        <input type="text" id="question-${questionCount}-topic" name="topics" class="form-control" 
               placeholder="e.g., algebra, fractions" value="general">
      </div>
    </div>
  `;
  
  container.appendChild(questionDiv);
  
  // Focus on the question text
  document.getElementById(`question-${questionCount}-text`).focus();
}

function removeQuestion(questionId) {
  const questionDiv = document.getElementById(`question-${questionId}`);
  if (questionDiv) {
    questionDiv.remove();
  }
  
  // Renumber remaining questions
  renumberQuestions();
}

function renumberQuestions() {
  const questions = document.querySelectorAll('[id^="question-"]');
  questions.forEach((question, index) => {
    const newNumber = index + 1;
    const h3 = question.querySelector('h3');
    if (h3) {
      h3.textContent = `Question ${newNumber}`;
    }
  });
}

// Add first question on page load
document.addEventListener('DOMContentLoaded', function() {
  addQuestion();
});

// Form validation
document.getElementById('quiz-form').addEventListener('submit', function(e) {
  const questions = document.querySelectorAll('textarea[name="questions"]');
  if (questions.length === 0) {
    e.preventDefault();
    alert('Please add at least one question.');
    return;
  }
  
  let hasValidQuestion = false;
  questions.forEach(question => {
    if (question.value.trim()) {
      hasValidQuestion = true;
    }
  });
  
  if (!hasValidQuestion) {
    e.preventDefault();
    alert('Please enter at least one valid question.');
    return;
  }
});
</script>
{% endblock %}