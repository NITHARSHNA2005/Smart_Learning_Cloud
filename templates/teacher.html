{% extends "base.html" %}

{% block title %}Teacher Dashboard - Smart Learning Cloud{% endblock %}

{% block content %}
<div class="hero" style="margin: -2rem -2rem 3rem -2rem; padding: 3rem 2rem;">
  <h1 style="margin: 0 0 1rem 0; font-size: 2.5rem;">ğŸ‘©ğŸ« Welcome to Teacher Dashboard</h1>
  <p class="lead">Create engaging lessons, manage content, and track student progress</p>
  <div class="stats-grid" style="margin: 2rem auto 0; max-width: 800px; grid-template-columns: repeat(4, 1fr);">
    <div class="stat-card" style="background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white;">
      <span class="stat-number" style="color: white;">{{ lessons|length }}</span>
      <span class="stat-label" style="color: rgba(255,255,255,0.9);">Total Lessons</span>
    </div>
    <div class="stat-card" style="background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white;">
      <span class="stat-number" style="color: white;">âˆ</span>
      <span class="stat-label" style="color: rgba(255,255,255,0.9);">Students Reached</span>
    </div>
    <div class="stat-card" style="background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white;">
      <span class="stat-number" style="color: white;">24/7</span>
      <span class="stat-label" style="color: rgba(255,255,255,0.9);">Platform Access</span>
    </div>
    <div class="stat-card" style="background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white;">
      <span class="stat-number" style="color: white;">ğŸ†</span>
      <span class="stat-label" style="color: rgba(255,255,255,0.9);">Impact Created</span>
    </div>
  </div>
</div>

<div class="card" style="margin-bottom: 2rem; background: linear-gradient(135deg, rgba(37, 99, 235, 0.05) 0%, rgba(14, 165, 233, 0.05) 100%); border: 2px solid var(--primary); box-shadow: var(--shadow-lg);">
  <h3 style="margin-top: 0; color: var(--primary); display: flex; align-items: center; gap: 0.75rem; font-size: 1.5rem;">
    <span style="background: var(--gradient); color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.2rem;">â•</span>
    Create New Lesson
  </h3>
  
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="alert alert-{{ 'success' if category == 'success' else 'info' }}" style="margin-bottom: 1rem;">
          {{ message }}
        </div>
      {% endfor %}
    {% endif %}
  {% endwith %}
  
  <form method="post" enctype="multipart/form-data">
    <div class="form-group">
      <label for="title" style="color: var(--text); font-weight: 600; display: flex; align-items: center; gap: 0.5rem;">
        <span style="color: var(--primary);">ğŸ“</span> Lesson Title
      </label>
      <input type="text" id="title" name="title" class="form-control" placeholder="e.g., Introduction to Algebra" required style="border: 2px solid var(--border); transition: all 0.3s ease;" onfocus="this.style.borderColor='var(--primary)'; this.style.boxShadow='0 0 0 3px rgba(37, 99, 235, 0.1)'" onblur="this.style.borderColor='var(--border)'; this.style.boxShadow='none'">
    </div>
    
    <div class="form-group">
      <label for="description" style="color: var(--text); font-weight: 600; display: flex; align-items: center; gap: 0.5rem;">
        <span style="color: var(--secondary);">ğŸ“œ</span> Description
      </label>
      <textarea id="description" name="description" class="form-control" rows="3" placeholder="Brief description of what students will learn..." required style="border: 2px solid var(--border); transition: all 0.3s ease; resize: vertical;" onfocus="this.style.borderColor='var(--primary)'; this.style.boxShadow='0 0 0 3px rgba(37, 99, 235, 0.1)'" onblur="this.style.borderColor='var(--border)'; this.style.boxShadow='none'"></textarea>
    </div>
    
    <div class="form-group">
      <label style="color: var(--text); font-weight: 600; display: flex; align-items: center; gap: 0.5rem;">
        <span style="color: var(--warning);">ğŸ¥</span> Video Content
      </label>
      <div style="border: 2px dashed var(--primary); border-radius: 1rem; padding: 2rem; margin-bottom: 1rem; background: linear-gradient(135deg, rgba(37, 99, 235, 0.02) 0%, rgba(14, 165, 233, 0.02) 100%); transition: all 0.3s ease;" onmouseover="this.style.borderColor='var(--primary-dark)'; this.style.background='linear-gradient(135deg, rgba(37, 99, 235, 0.05) 0%, rgba(14, 165, 233, 0.05) 100%)'" onmouseout="this.style.borderColor='var(--primary)'; this.style.background='linear-gradient(135deg, rgba(37, 99, 235, 0.02) 0%, rgba(14, 165, 233, 0.02) 100%)'">
        <div style="text-align: center; margin-bottom: 1.5rem;">
          <div style="font-size: 3rem; margin-bottom: 0.5rem;">ğŸ¥</div>
          <h4 style="margin: 0 0 0.5rem 0; color: var(--primary); font-size: 1.25rem;">Choose Video Option</h4>
          <p style="color: var(--text-light); margin: 0; font-size: 0.95rem;">Upload a video file or provide a URL to get started</p>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;">
          <div style="background: var(--card); border: 2px solid var(--border); border-radius: 0.75rem; padding: 1rem; cursor: pointer; transition: all 0.3s ease;" onclick="document.getElementById('upload_option').click()" id="upload_card">
            <input type="radio" id="upload_option" name="video_option" value="upload" onchange="toggleVideoOptions()" checked style="margin-bottom: 0.5rem;">
            <label for="upload_option" style="cursor: pointer; font-weight: 600; color: var(--primary); display: flex; align-items: center; gap: 0.5rem; margin: 0;">
              <span style="font-size: 1.5rem;">ğŸ“¹</span> Upload Video File
            </label>
            <p style="margin: 0.5rem 0 0 0; font-size: 0.85rem; color: var(--text-light);">Upload from your device</p>
          </div>
          <div style="background: var(--card); border: 2px solid var(--border); border-radius: 0.75rem; padding: 1rem; cursor: pointer; transition: all 0.3s ease;" onclick="document.getElementById('url_option').click()" id="url_card">
            <input type="radio" id="url_option" name="video_option" value="url" onchange="toggleVideoOptions()" style="margin-bottom: 0.5rem;">
            <label for="url_option" style="cursor: pointer; font-weight: 600; color: var(--secondary); display: flex; align-items: center; gap: 0.5rem; margin: 0;">
              <span style="font-size: 1.5rem;">ğŸ”—</span> Video URL
            </label>
            <p style="margin: 0.5rem 0 0 0; font-size: 0.85rem; color: var(--text-light);">Link from YouTube, Vimeo, etc.</p>
          </div>
        </div>
        
        <div id="upload_section" style="background: rgba(255, 255, 255, 0.5); border-radius: 0.75rem; padding: 1.5rem;">
          <label for="video_file" style="font-weight: 600; color: var(--text); margin-bottom: 0.75rem; display: block;">Select Video File</label>
          <input type="file" id="video_file" name="video_file" class="form-control" accept=".mp4,.avi,.mov,.wmv,.flv,.webm" style="border: 2px dashed var(--primary); background: var(--card); padding: 1rem;">
          <div style="margin-top: 1rem; padding: 0.75rem; background: rgba(37, 99, 235, 0.1); border-radius: 0.5rem; border-left: 4px solid var(--primary);">
            <small style="color: var(--primary); font-weight: 500;">
              ğŸ“ <strong>Supported formats:</strong> MP4, AVI, MOV, WMV, FLV, WebM<br>
              ğŸ“Š <strong>Maximum size:</strong> 500MB
            </small>
          </div>
        </div>
        
        <div id="url_section" style="display: none; background: rgba(255, 255, 255, 0.5); border-radius: 0.75rem; padding: 1.5rem;">
          <label for="video_url" style="font-weight: 600; color: var(--text); margin-bottom: 0.75rem; display: block;">Video URL</label>
          <input type="url" id="video_url" name="video_url" class="form-control" placeholder="https://www.youtube.com/watch?v=..." style="border: 2px solid var(--border);">
          <div style="margin-top: 1rem; padding: 0.75rem; background: rgba(14, 165, 233, 0.1); border-radius: 0.5rem; border-left: 4px solid var(--secondary);">
            <small style="color: var(--secondary); font-weight: 500;">
              ğŸ“ <strong>Tip:</strong> Works with YouTube, Vimeo, and most video platforms<br>
              âœ¨ <strong>Best practice:</strong> Use unlisted YouTube videos for privacy
            </small>
          </div>
        </div>
      </div>
    </div>
    
    <button type="submit" class="btn" style="background: var(--gradient); border: none; padding: 1rem 2rem; font-size: 1.1rem; font-weight: 600; box-shadow: var(--shadow-md); transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='var(--shadow-lg)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='var(--shadow-md)'">
      âœ¨ Create Lesson
    </button>
  </form>
</div>

<h2 class="section-title" style="display: flex; align-items: center; gap: 0.75rem;">
  <span style="background: var(--gradient); color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.2rem;">ğŸ“š</span>
  Your Lessons
</h2>
{% if lessons %}
<div class="cards">
  {% for l in lessons %}
  <div class="card" style="border-left: 4px solid var(--primary); transition: all 0.3s ease;" onmouseover="this.style.borderLeftColor='var(--secondary)'; this.style.transform='translateX(4px)'" onmouseout="this.style.borderLeftColor='var(--primary)'; this.style.transform='translateX(0)'">
    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
      <h3 style="margin: 0; color: var(--primary); font-size: 1.25rem;">{{ l['title'] }}</h3>
      <span class="badge badge-success" style="background: var(--gradient); border: none;">âœ¨ Active</span>
    </div>
    <p style="color: var(--text-light); line-height: 1.6; margin-bottom: 1.5rem;">{{ l['description'] }}</p>
    
    <div style="display: flex; gap: 1rem; margin: 1.5rem 0; flex-wrap: wrap; padding: 1rem; background: var(--bg); border-radius: 0.5rem;">
      {% if l['video_url'] %}
        <div style="display: flex; align-items: center; gap: 0.5rem; color: var(--success); font-weight: 500;">
          <span style="font-size: 1.2rem;">âœ“</span> Video Added
        </div>
      {% else %}
        <div style="display: flex; align-items: center; gap: 0.5rem; color: var(--warning); font-weight: 500;">
          <span style="font-size: 1.2rem;">âš </span> No Video
        </div>
      {% endif %}
      
      <div style="display: flex; align-items: center; gap: 0.5rem; color: var(--text-muted);">
        <span style="font-size: 1rem;">ğŸ“…</span> Created: {{ l['created_at'][:10] }}
      </div>
    </div>
    
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 0.5rem; margin-top: 1.5rem;">
      <!-- Primary Actions -->
      <a class="btn" href="{{ url_for('lesson_page', lesson_id=l['id']) }}" style="background: var(--secondary); border: none; display: flex; align-items: center; justify-content: center; gap: 0.5rem; font-size: 0.85rem; padding: 0.6rem 0.8rem; border-radius: 0.5rem;">
        <span style="font-size: 1rem;">ğŸ‘</span>
        <span>Preview</span>
      </a>
      
      <a class="btn" href="{{ url_for('edit_lesson', lesson_id=l['id']) }}" style="background: var(--primary); border: none; display: flex; align-items: center; justify-content: center; gap: 0.5rem; font-size: 0.85rem; padding: 0.6rem 0.8rem; border-radius: 0.5rem;">
        <span style="font-size: 1rem;">âœï¸</span>
        <span>Edit</span>
      </a>
      
      <!-- Quiz Actions -->
      {% set quiz = lessons_with_quizzes.get(l['id']) %}
      {% if quiz %}
        <a class="btn" href="{{ url_for('edit_quiz', quiz_id=quiz['id']) }}" style="background: var(--warning); color: white; border: none; display: flex; align-items: center; justify-content: center; gap: 0.5rem; font-size: 0.85rem; padding: 0.6rem 0.8rem; border-radius: 0.5rem;">
          <span style="font-size: 1rem;">ğŸ“‹</span>
          <span>Edit Quiz</span>
        </a>
      {% else %}
        <a class="btn" href="{{ url_for('create_quiz', lesson_id=l['id']) }}" style="background: var(--success); color: white; border: none; display: flex; align-items: center; justify-content: center; gap: 0.5rem; font-size: 0.85rem; padding: 0.6rem 0.8rem; border-radius: 0.5rem;">
          <span style="font-size: 1rem;">â•</span>
          <span>Add Quiz</span>
        </a>
      {% endif %}
      
      <!-- Danger Action -->
      <form method="post" action="{{ url_for('delete_lesson', lesson_id=l['id']) }}" style="display: contents;" onsubmit="return confirm('âš ï¸ Are you sure you want to delete this lesson?\n\nThis will permanently remove:\nâ€¢ The lesson content\nâ€¢ Associated quiz\nâ€¢ All student attempts\n\nThis action cannot be undone!')">
        <button type="submit" class="btn" style="background: var(--danger); border: none; display: flex; align-items: center; justify-content: center; gap: 0.5rem; font-size: 0.85rem; padding: 0.6rem 0.8rem; border-radius: 0.5rem; cursor: pointer;">
          <span style="font-size: 1rem;">ğŸ—‘ï¸</span>
          <span>Delete</span>
        </button>
      </form>
    </div>
  </div>
  {% endfor %}
</div>
{% else %}
<div class="alert alert-info">
  <strong>No lessons created yet.</strong> Create your first lesson using the form above to get started!
</div>
{% endif %}

<div class="card" style="margin-top: 3rem; background: var(--gradient); color: white; box-shadow: var(--shadow-xl);">
  <h3 style="margin-top: 0; display: flex; align-items: center; gap: 0.75rem; font-size: 1.5rem; color: white;">
    <span style="background: rgba(255, 255, 255, 0.2); width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.2rem;">ğŸ’¡</span>
    Pro Teaching Tips
  </h3>
  <div style="display: grid; gap: 1rem; margin-top: 1.5rem;">
    <div style="display: flex; align-items: center; gap: 1rem; padding: 1rem; background: rgba(255, 255, 255, 0.1); border-radius: 0.75rem; backdrop-filter: blur(10px);">
      <span style="background: rgba(255, 255, 255, 0.2); color: white; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.9rem; font-weight: 600;">1</span>
      <span>Keep video lessons between 10-15 minutes for optimal engagement</span>
    </div>
    <div style="display: flex; align-items: center; gap: 1rem; padding: 1rem; background: rgba(255, 255, 255, 0.1); border-radius: 0.75rem; backdrop-filter: blur(10px);">
      <span style="background: rgba(255, 255, 255, 0.2); color: white; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.9rem; font-weight: 600;">2</span>
      <span>Design quizzes with 4-6 questions to test key concepts effectively</span>
    </div>
    <div style="display: flex; align-items: center; gap: 1rem; padding: 1rem; background: rgba(255, 255, 255, 0.1); border-radius: 0.75rem; backdrop-filter: blur(10px);">
      <span style="background: rgba(255, 255, 255, 0.2); color: white; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.9rem; font-weight: 600;">3</span>
      <span>Use clear, simple language that rural students can easily understand</span>
    </div>
    <div style="display: flex; align-items: center; gap: 1rem; padding: 1rem; background: rgba(255, 255, 255, 0.1); border-radius: 0.75rem; backdrop-filter: blur(10px);">
      <span style="background: rgba(255, 255, 255, 0.2); color: white; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.9rem; font-weight: 600;">4</span>
      <span>Include real-world examples to make abstract concepts relatable</span>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function toggleVideoOptions() {
  const uploadOption = document.getElementById('upload_option');
  const urlOption = document.getElementById('url_option');
  const uploadSection = document.getElementById('upload_section');
  const urlSection = document.getElementById('url_section');
  const uploadCard = document.getElementById('upload_card');
  const urlCard = document.getElementById('url_card');
  const videoFile = document.getElementById('video_file');
  const videoUrl = document.getElementById('video_url');
  
  if (uploadOption.checked) {
    uploadSection.style.display = 'block';
    urlSection.style.display = 'none';
    uploadCard.style.borderColor = 'var(--primary)';
    uploadCard.style.background = 'rgba(37, 99, 235, 0.1)';
    urlCard.style.borderColor = 'var(--border)';
    urlCard.style.background = 'var(--card)';
    videoFile.required = false;
    videoUrl.required = false;
    videoUrl.value = '';
  } else {
    uploadSection.style.display = 'none';
    urlSection.style.display = 'block';
    urlCard.style.borderColor = 'var(--secondary)';
    urlCard.style.background = 'rgba(14, 165, 233, 0.1)';
    uploadCard.style.borderColor = 'var(--border)';
    uploadCard.style.background = 'var(--card)';
    videoFile.required = false;
    videoUrl.required = false;
    videoFile.value = '';
  }
}

document.addEventListener('DOMContentLoaded', function() {
  toggleVideoOptions();
});
</script>
{% endblock %}