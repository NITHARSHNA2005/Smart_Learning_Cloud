{% extends "base.html" %}
{% block title %}Virtual Lab - Smart Learning Cloud{% endblock %}
{% block content %}
<div class="container">
  <div class="page-header">
    <h1>üß™ Virtual Math Lab</h1>
    <p>Experiment with mathematical concepts in an interactive environment!</p>
  </div>

  <div class="lab-container">
    <div class="lab-tabs">
      <button class="lab-tab active" onclick="switchLab('fractionLab')">üç∞ Fraction Visualizer</button>
      <button class="lab-tab" onclick="switchLab('graphLab')">üìä Graph Plotter</button>
      <button class="lab-tab" onclick="switchLab('calculatorLab')">üî¢ Advanced Calculator</button>
    </div>

    <div class="lab-content">
      <!-- Fraction Visualizer -->
      <div class="lab-panel active" id="fractionLab">
        <h3>üç∞ Interactive Fraction Visualizer</h3>
        <div class="controls">
          <div class="control-group">
            <label>Numerator:</label>
            <input type="range" id="numerator" min="0" max="12" value="3" oninput="updateFraction()">
            <span id="numValue">3</span>
          </div>
          <div class="control-group">
            <label>Denominator:</label>
            <input type="range" id="denominator" min="1" max="12" value="4" oninput="updateFraction()">
            <span id="denValue">4</span>
          </div>
        </div>
        
        <div class="visualization">
          <div class="fraction-display">
            <span id="fractionText">3/4</span> = <span id="decimalText">0.75</span>
          </div>
          <div class="visual-fraction" id="visualFraction"></div>
          <div class="percentage">= <span id="percentageText">75%</span></div>
        </div>
      </div>

      <!-- Graph Plotter -->
      <div class="lab-panel" id="graphLab">
        <h3>üìä Function Graph Plotter</h3>
        <div class="controls">
          <div class="control-group">
            <label>Function: y =</label>
            <select id="functionType" onchange="updateGraph()">
              <option value="linear">x (Linear)</option>
              <option value="quadratic">x¬≤ (Quadratic)</option>
              <option value="cubic">x¬≥ (Cubic)</option>
              <option value="sine">sin(x)</option>
            </select>
          </div>
          <div class="control-group">
            <label>Coefficient:</label>
            <input type="range" id="coefficient" min="-5" max="5" step="0.1" value="1" oninput="updateGraph()">
            <span id="coeffValue">1</span>
          </div>
        </div>
        
        <div class="graph-container">
          <canvas id="graphCanvas" width="400" height="300"></canvas>
        </div>
        
        <div class="graph-info">
          <p>Current function: y = <span id="currentFunction">x</span></p>
        </div>
      </div>

      <!-- Advanced Calculator -->
      <div class="lab-panel" id="calculatorLab">
        <h3>üî¢ Scientific Calculator</h3>
        <div class="calculator">
          <div class="calc-display">
            <input type="text" id="calcDisplay" readonly>
          </div>
          <div class="calc-buttons">
            <button onclick="clearCalc()" class="calc-btn clear">C</button>
            <button onclick="deleteLast()" class="calc-btn">‚å´</button>
            <button onclick="appendToCalc('/')" class="calc-btn operator">√∑</button>
            <button onclick="appendToCalc('*')" class="calc-btn operator">√ó</button>
            
            <button onclick="appendToCalc('7')" class="calc-btn">7</button>
            <button onclick="appendToCalc('8')" class="calc-btn">8</button>
            <button onclick="appendToCalc('9')" class="calc-btn">9</button>
            <button onclick="appendToCalc('-')" class="calc-btn operator">-</button>
            
            <button onclick="appendToCalc('4')" class="calc-btn">4</button>
            <button onclick="appendToCalc('5')" class="calc-btn">5</button>
            <button onclick="appendToCalc('6')" class="calc-btn">6</button>
            <button onclick="appendToCalc('+')" class="calc-btn operator">+</button>
            
            <button onclick="appendToCalc('1')" class="calc-btn">1</button>
            <button onclick="appendToCalc('2')" class="calc-btn">2</button>
            <button onclick="appendToCalc('3')" class="calc-btn">3</button>
            <button onclick="calculate()" class="calc-btn equals" rowspan="2">=</button>
            
            <button onclick="appendToCalc('0')" class="calc-btn zero">0</button>
            <button onclick="appendToCalc('.')" class="calc-btn">.</button>
            <button onclick="squareRoot()" class="calc-btn">‚àö</button>
          </div>
        </div>
        
        <div class="calc-history">
          <h4>Recent Calculations:</h4>
          <div id="calcHistory"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
.lab-container {
  max-width: 800px;
  margin: 0 auto;
}

.lab-tabs {
  display: flex;
  gap: 0.5rem;
  margin-bottom: 2rem;
  justify-content: center;
  flex-wrap: wrap;
}

.lab-tab {
  padding: 0.75rem 1.5rem;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 0.5rem;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.3s ease;
}

.lab-tab:hover {
  background: var(--primary);
  color: white;
}

.lab-tab.active {
  background: var(--primary);
  color: white;
}

.lab-panel {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 1rem;
  padding: 2rem;
  display: none;
}

.lab-panel.active {
  display: block;
}

.lab-panel h3 {
  margin: 0 0 2rem 0;
  color: var(--primary);
  text-align: center;
}

.controls {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1rem;
  margin-bottom: 2rem;
  padding: 1rem;
  background: var(--bg);
  border-radius: 0.5rem;
}

.control-group {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.control-group label {
  font-weight: 600;
  min-width: 80px;
}

.control-group input[type="range"] {
  flex: 1;
}

.control-group span {
  font-weight: 600;
  color: var(--primary);
  min-width: 30px;
}

.visualization {
  text-align: center;
}

.fraction-display {
  font-size: 2rem;
  font-weight: 600;
  margin-bottom: 2rem;
  color: var(--text);
}

.visual-fraction {
  display: flex;
  justify-content: center;
  gap: 2px;
  margin: 2rem 0;
  flex-wrap: wrap;
}

.fraction-part {
  width: 40px;
  height: 40px;
  border: 2px solid var(--primary);
  border-radius: 4px;
  transition: all 0.3s ease;
}

.fraction-part.filled {
  background: var(--primary);
}

.percentage {
  font-size: 1.5rem;
  font-weight: 600;
  color: var(--secondary);
}

.graph-container {
  display: flex;
  justify-content: center;
  margin: 2rem 0;
  background: var(--bg);
  border-radius: 0.5rem;
  padding: 1rem;
}

#graphCanvas {
  border: 1px solid var(--border);
  border-radius: 0.5rem;
  background: white;
}

.graph-info {
  text-align: center;
  font-size: 1.1rem;
  font-weight: 600;
  color: var(--text);
}

.calculator {
  max-width: 300px;
  margin: 0 auto;
  background: var(--bg);
  border-radius: 1rem;
  padding: 1rem;
  box-shadow: var(--shadow-md);
}

.calc-display {
  margin-bottom: 1rem;
}

.calc-display input {
  width: 100%;
  padding: 1rem;
  font-size: 1.5rem;
  text-align: right;
  background: white;
  border: 1px solid var(--border);
  border-radius: 0.5rem;
}

.calc-buttons {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 0.5rem;
}

.calc-btn {
  padding: 1rem;
  border: none;
  border-radius: 0.5rem;
  font-size: 1.1rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s ease;
  background: var(--card);
  border: 1px solid var(--border);
}

.calc-btn:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-md);
}

.calc-btn.operator {
  background: var(--primary);
  color: white;
}

.calc-btn.equals {
  background: var(--success);
  color: white;
  grid-row: span 2;
}

.calc-btn.clear {
  background: var(--danger);
  color: white;
}

.calc-btn.zero {
  grid-column: span 2;
}

.calc-history {
  margin-top: 2rem;
  padding: 1rem;
  background: var(--bg);
  border-radius: 0.5rem;
}

.calc-history h4 {
  margin: 0 0 1rem 0;
  color: var(--text);
}

.history-item {
  padding: 0.5rem;
  border-bottom: 1px solid var(--border);
  font-family: monospace;
}
</style>

<script>
let calcHistory = [];

function switchLab(labId) {
  document.querySelectorAll('.lab-panel').forEach(panel => panel.classList.remove('active'));
  document.querySelectorAll('.lab-tab').forEach(tab => tab.classList.remove('active'));
  
  document.getElementById(labId).classList.add('active');
  event.target.classList.add('active');
  
  if (labId === 'fractionLab') updateFraction();
  if (labId === 'graphLab') updateGraph();
}

function updateFraction() {
  const num = parseInt(document.getElementById('numerator').value);
  const den = parseInt(document.getElementById('denominator').value);
  
  document.getElementById('numValue').textContent = num;
  document.getElementById('denValue').textContent = den;
  document.getElementById('fractionText').textContent = `${num}/${den}`;
  
  const decimal = (num / den).toFixed(3);
  document.getElementById('decimalText').textContent = decimal;
  
  const percentage = ((num / den) * 100).toFixed(1);
  document.getElementById('percentageText').textContent = `${percentage}%`;
  
  // Visual representation
  const container = document.getElementById('visualFraction');
  container.innerHTML = '';
  
  for (let i = 0; i < den; i++) {
    const part = document.createElement('div');
    part.className = 'fraction-part';
    if (i < num) part.classList.add('filled');
    container.appendChild(part);
  }
}

function updateGraph() {
  const canvas = document.getElementById('graphCanvas');
  const ctx = canvas.getContext('2d');
  const type = document.getElementById('functionType').value;
  const coeff = parseFloat(document.getElementById('coefficient').value);
  
  document.getElementById('coeffValue').textContent = coeff;
  
  // Clear canvas
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  
  // Draw axes
  ctx.strokeStyle = '#ccc';
  ctx.lineWidth = 1;
  
  // X-axis
  ctx.beginPath();
  ctx.moveTo(0, canvas.height / 2);
  ctx.lineTo(canvas.width, canvas.height / 2);
  ctx.stroke();
  
  // Y-axis
  ctx.beginPath();
  ctx.moveTo(canvas.width / 2, 0);
  ctx.lineTo(canvas.width / 2, canvas.height);
  ctx.stroke();
  
  // Draw function
  ctx.strokeStyle = '#2563eb';
  ctx.lineWidth = 2;
  ctx.beginPath();
  
  const scale = 20;
  const centerX = canvas.width / 2;
  const centerY = canvas.height / 2;
  
  for (let x = -10; x <= 10; x += 0.1) {
    let y;
    switch (type) {
      case 'linear': y = coeff * x; break;
      case 'quadratic': y = coeff * x * x; break;
      case 'cubic': y = coeff * x * x * x; break;
      case 'sine': y = coeff * Math.sin(x); break;
    }
    
    const canvasX = centerX + x * scale;
    const canvasY = centerY - y * scale;
    
    if (x === -10) {
      ctx.moveTo(canvasX, canvasY);
    } else {
      ctx.lineTo(canvasX, canvasY);
    }
  }
  
  ctx.stroke();
  
  // Update function display
  let funcText;
  switch (type) {
    case 'linear': funcText = `${coeff}x`; break;
    case 'quadratic': funcText = `${coeff}x¬≤`; break;
    case 'cubic': funcText = `${coeff}x¬≥`; break;
    case 'sine': funcText = `${coeff}sin(x)`; break;
  }
  document.getElementById('currentFunction').textContent = funcText;
}

function appendToCalc(value) {
  document.getElementById('calcDisplay').value += value;
}

function clearCalc() {
  document.getElementById('calcDisplay').value = '';
}

function deleteLast() {
  const display = document.getElementById('calcDisplay');
  display.value = display.value.slice(0, -1);
}

function calculate() {
  const display = document.getElementById('calcDisplay');
  const expression = display.value;
  
  try {
    // Replace display symbols with JavaScript operators
    const jsExpression = expression.replace(/√ó/g, '*').replace(/√∑/g, '/');
    const result = eval(jsExpression);
    
    // Add to history
    calcHistory.unshift(`${expression} = ${result}`);
    if (calcHistory.length > 5) calcHistory.pop();
    
    updateCalcHistory();
    display.value = result;
  } catch (error) {
    display.value = 'Error';
  }
}

function squareRoot() {
  const display = document.getElementById('calcDisplay');
  const value = parseFloat(display.value);
  if (!isNaN(value) && value >= 0) {
    display.value = Math.sqrt(value);
  }
}

function updateCalcHistory() {
  const historyDiv = document.getElementById('calcHistory');
  historyDiv.innerHTML = calcHistory.map(item => 
    `<div class="history-item">${item}</div>`
  ).join('');
}

// Initialize
updateFraction();
</script>
{% endblock %}