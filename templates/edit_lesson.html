{% extends "base.html" %}

{% block title %}Edit Lesson - {{ lesson['title'] }} - Smart Learning Cloud{% endblock %}

{% block content %}
<div style="margin-bottom: 2rem;">
  <a href="{{ url_for('teacher') }}" style="color: var(--primary); text-decoration: none; font-weight: 500;">
    ‚Üê Back to Teacher Dashboard
  </a>
</div>

<div class="card" style="margin-bottom: 2rem; background: linear-gradient(135deg, rgba(37, 99, 235, 0.05) 0%, rgba(14, 165, 233, 0.05) 100%); border: 2px solid var(--primary);">
  <h1 style="margin: 0 0 1rem 0; color: var(--primary); display: flex; align-items: center; gap: 0.75rem;">
    <span style="background: var(--gradient); color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.2rem;">‚úèÔ∏è</span>
    Edit Lesson
  </h1>
  <p style="color: var(--text-light); margin: 0;">Editing: <strong>{{ lesson['title'] }}</strong></p>
</div>

{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
      <div class="alert alert-{{ 'success' if category == 'success' else 'danger' }}" style="margin-bottom: 1rem;">
        {{ message }}
      </div>
    {% endfor %}
  {% endif %}
{% endwith %}

<form method="post" enctype="multipart/form-data">
  <div class="card" style="margin-bottom: 2rem;">
    <h3 style="margin-top: 0; color: var(--primary);">üìù Lesson Details</h3>
    
    <div class="form-group">
      <label for="title" style="color: var(--text); font-weight: 600;">Lesson Title</label>
      <input type="text" id="title" name="title" class="form-control" value="{{ lesson['title'] }}" required>
    </div>
    
    <div class="form-group">
      <label for="description" style="color: var(--text); font-weight: 600;">Description</label>
      <textarea id="description" name="description" class="form-control" rows="3" required>{{ lesson['description'] }}</textarea>
    </div>
  </div>

  <div class="card" style="margin-bottom: 2rem;">
    <h3 style="margin-top: 0; color: var(--warning);">üé• Video Content</h3>
    
    {% if lesson['video_url'] %}
    <div class="alert alert-info" style="margin-bottom: 1rem;">
      <strong>Current Video:</strong> Video is already uploaded. Upload a new file or provide a new URL to replace it.
    </div>
    {% endif %}
    
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
      <div>
        <input type="radio" id="upload_option" name="video_option" value="upload" onchange="toggleVideoOptions()" checked>
        <label for="upload_option" style="margin-left: 0.5rem; font-weight: 500;">üìπ Upload New Video</label>
      </div>
      <div>
        <input type="radio" id="url_option" name="video_option" value="url" onchange="toggleVideoOptions()">
        <label for="url_option" style="margin-left: 0.5rem; font-weight: 500;">üîó Video URL</label>
      </div>
    </div>
    
    <div id="upload_section">
      <label for="video_file">Upload Video File</label>
      <input type="file" id="video_file" name="video_file" class="form-control" accept=".mp4,.avi,.mov,.wmv,.flv,.webm">
      <small style="color: var(--text-light); margin-top: 0.5rem; display: block;">
        üìù Supported formats: MP4, AVI, MOV, WMV, FLV, WebM (Max: 500MB)
      </small>
    </div>
    
    <div id="url_section" style="display: none;">
      <label for="video_url">Video URL</label>
      <input type="url" id="video_url" name="video_url" class="form-control" value="{{ lesson['video_url'] or '' }}" placeholder="https://www.youtube.com/watch?v=...">
      <small style="color: var(--text-light); margin-top: 0.5rem; display: block;">
        üìù Tip: Use YouTube, Vimeo, or any video platform URL
      </small>
    </div>
  </div>

  <div class="card" style="text-align: center;">
    <button type="submit" class="btn" style="background: var(--gradient); border: none; padding: 1rem 2rem; font-size: 1.1rem;">
      ‚ú® Update Lesson
    </button>
    <a href="{{ url_for('teacher') }}" class="btn btn-secondary" style="margin-left: 1rem;">
      Cancel
    </a>
  </div>
</form>
{% endblock %}

{% block scripts %}
<script>
function toggleVideoOptions() {
  const uploadOption = document.getElementById('upload_option');
  const urlOption = document.getElementById('url_option');
  const uploadSection = document.getElementById('upload_section');
  const urlSection = document.getElementById('url_section');
  const videoFile = document.getElementById('video_file');
  const videoUrl = document.getElementById('video_url');
  
  if (uploadOption.checked) {
    uploadSection.style.display = 'block';
    urlSection.style.display = 'none';
    videoFile.required = false;
    videoUrl.required = false;
  } else {
    uploadSection.style.display = 'none';
    urlSection.style.display = 'block';
    videoFile.required = false;
    videoUrl.required = false;
  }
}

document.addEventListener('DOMContentLoaded', function() {
  toggleVideoOptions();
});
</script>
{% endblock %}